<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Photo to Scan Converter - Artha</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.0/jszip.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0;
      padding: 0;
      color: #333;
    }
    .container {
      max-width: 1200px;
      margin: auto;
      padding: 20px;
    }
    .header, .upload-section, .controls, .download-section {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      text-align: center;
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
    }
    canvas {
      max-width: 100%;
      margin: 10px 0;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    input[type="file"] {
      margin: 10px auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h2>‚ú® Artha Photo to Scan Converter ‚ú®</h2>
      <p>Made with ‚ù§Ô∏è by Artha Education Institute</p>
    </div>

    <div class="upload-section">
      <input type="file" id="upload" accept="image/*" multiple>
      <button id="cameraBtn">üì∑ Capture from Camera</button>
    </div>

    <div class="controls">
      <label>Brightness: <input type="range" id="brightness" min="0" max="3" step="0.1" value="1.5"></label>
      <label>Contrast: <input type="range" id="contrast" min="0" max="3" step="0.1" value="2"></label>
      <label>Grayscale: <input type="range" id="gray" min="0" max="1" step="0.1" value="1"></label>
      <div>
        <button id="applyBtn">‚ú® Apply Effect</button>
        <button id="applyAllBtn">‚ú® Apply All</button>
        <button id="clearBtn">üóëÔ∏è Clear All</button>
      </div>
    </div>

    <div id="canvasContainer" class="canvas-container"></div>

    <div class="download-section">
      <button id="downloadAllJpg">üíæ Download JPGs (ZIP)</button>
      <button id="downloadPDF">üìÑ Download PDF</button>
      <button id="shareBtn">üì§ Share This App</button>
    </div>

<script>
  const upload = document.getElementById('upload');
  const cameraBtn = document.getElementById('cameraBtn');
  const canvasContainer = document.getElementById('canvasContainer');
  const brightnessSlider = document.getElementById('brightness');
  const contrastSlider = document.getElementById('contrast');
  const graySlider = document.getElementById('gray');
  const applyBtn = document.getElementById('applyBtn');
  const applyAllBtn = document.getElementById('applyAllBtn');
  const clearBtn = document.getElementById('clearBtn');
  const downloadAllJpg = document.getElementById('downloadAllJpg');
  const downloadPDF = document.getElementById('downloadPDF');
  const shareBtn = document.getElementById('shareBtn');

  let canvases = [];

  function handleImage(file) {
    const img = new Image();
    img.onload = () => {
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      canvas.width = img.width;
      canvas.height = img.height;
      ctx.drawImage(img, 0, 0);
      canvasContainer.appendChild(canvas);
      canvases.push(canvas);
    };
    img.src = URL.createObjectURL(file);
  }

  upload.addEventListener('change', (e) => {
    Array.from(e.target.files).forEach(handleImage);
  });

  applyBtn.addEventListener('click', () => {
    if (canvases.length) applyEffectToCanvas(canvases[canvases.length - 1]);
  });

  applyAllBtn.addEventListener('click', () => {
    canvases.forEach(applyEffectToCanvas);
  });

  clearBtn.addEventListener('click', () => {
    canvasContainer.innerHTML = '';
    canvases = [];
  });

  function applyEffectToCanvas(canvas) {
    const brightness = parseFloat(brightnessSlider.value);
    const contrast = parseFloat(contrastSlider.value);
    const grayscale = parseFloat(graySlider.value);
    const ctx = canvas.getContext('2d');
    let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    let data = imageData.data;
    for (let i = 0; i < data.length; i += 4) {
      let r = data[i], g = data[i + 1], b = data[i + 2];
      const avg = (r + g + b) / 3;
      r = r * (1 - grayscale) + avg * grayscale;
      g = g * (1 - grayscale) + avg * grayscale;
      b = b * (1 - grayscale) + avg * grayscale;
      r = (r - 128) * contrast + 128;
      g = (g - 128) * contrast + 128;
      b = (b - 128) * contrast + 128;
      r *= brightness;
      g *= brightness;
      b *= brightness;
      data[i] = Math.min(255, Math.max(0, r));
      data[i + 1] = Math.min(255, Math.max(0, g));
      data[i + 2] = Math.min(255, Math.max(0, b));
    }
    ctx.putImageData(imageData, 0, 0);
  }
</script>
<script>
  // üì∑ CAMERA FUNCTIONALITY
  cameraBtn.addEventListener('click', async () => {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: { ideal: 'environment' } }
      });

      const video = document.createElement('video');
      video.srcObject = stream;
      video.autoplay = true;
      video.playsInline = true;

      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.8); display: flex; flex-direction: column;
        justify-content: center; align-items: center; z-index: 9999;
      `;
      video.style.cssText = 'max-width: 90%; border-radius: 12px;';
      
      const captureBtn = document.createElement('button');
      captureBtn.textContent = 'üì∏ Capture';
      captureBtn.style.margin = '10px';

      const closeBtn = document.createElement('button');
      closeBtn.textContent = '‚ùå Close';

      modal.appendChild(video);
      modal.appendChild(captureBtn);
      modal.appendChild(closeBtn);
      document.body.appendChild(modal);

      captureBtn.onclick = () => {
        const canvas = document.createElement('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0);
        canvas.toBlob(blob => {
          const file = new File([blob], 'camera.jpg', { type: 'image/jpeg' });
          handleImage(file);
        });
        stream.getTracks().forEach(track => track.stop());
        document.body.removeChild(modal);
      };

      closeBtn.onclick = () => {
        stream.getTracks().forEach(track => track.stop());
        document.body.removeChild(modal);
      };

    } catch (err) {
      alert('Camera access denied or not available.');
    }
  });

  // üíæ JPG ZIP DOWNLOAD FIX
  downloadAllJpg.addEventListener('click', () => {
    const zip = new JSZip();
    canvases.forEach((canvas, index) => {
      const dataURL = canvas.toDataURL('image/jpeg', 1.0);
      const imgData = dataURL.split(',')[1];
      zip.file(`scan-${index + 1}.jpg`, imgData, { base64: true });
    });
    zip.generateAsync({ type: 'blob' }).then(content => {
      const link = document.createElement('a');
      link.href = URL.createObjectURL(content);
      link.download = 'scanned-images.zip';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });
  });

  // üìÑ PDF DOWNLOAD FIX
  downloadPDF.addEventListener('click', () => {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();
    canvases.forEach((canvas, i) => {
      const imgData = canvas.toDataURL('image/jpeg', 1.0);
      const width = pdf.internal.pageSize.getWidth();
      const height = pdf.internal.pageSize.getHeight();
      pdf.addImage(imgData, 'JPEG', 0, 0, width, height);
      if (i < canvases.length - 1) pdf.addPage();
    });
    const blob = pdf.output('blob');
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'scanned-pages.pdf';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  });

  // üì§ SHARE BUTTON
  shareBtn.addEventListener('click', async () => {
    if (navigator.share) {
      try {
        await navigator.share({
          title: 'Artha Photo Scan Converter',
          text: 'Try this app made by Artha Education Institute!',
          url: window.location.href
        });
      } catch (err) {
        alert('Sharing canceled or failed.');
      }
    } else {
      alert('Web Share API not supported on your device.');
    }
  });
</script>
</body>
</html>
